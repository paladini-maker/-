<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Receiver CAF â€” Shaka ClearKey</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.15.12/shaka-player.compiled.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.15.12/controls.css">
<style>html,body{margin:0;height:100%;background:#000} video{width:100%;height:100%;background:#000}</style>
</head>
<body>
<video id="video" autoplay playsinline></video>
<script>
(async function(){
  const context = cast.framework.CastReceiverContext.getInstance();
  context.start();

  const player = new shaka.Player(document.getElementById('video'));
  player.addEventListener('error', e=>console.error('Shaka error',e.detail));

  const manager = context.getPlayerManager();
  manager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, async request=>{
    const media = request.media;
    if(!media) return request;

    const src = media.contentId;
    const customData = media.customData || {};
    const drmConfig = (customData.shaka && customData.shaka.drm) || {};

    try{
      player.configure({ drm: drmConfig });
      await player.load(src);
      console.log('Media cargado', src);
    }catch(err){ console.error('Error cargando media:', err); }

    return request;
  });
})();
</script>
</body>
</html>
