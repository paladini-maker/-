<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shaka + Cast integrado</title>

  <!-- Cast init FIRST -->
  <script>
    window.__onGCastApiAvailable = function(isAvailable) {
      if (isAvailable) {
        cast.framework.CastContext.getInstance().setOptions({
          receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID
        });
      }
    };
  </script>

  <!-- Cast Framework -->
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

  <!-- Shaka -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.12.3/shaka-player.ui.min.js"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.12.3/controls.min.css">

  <style>
    body { background: #111; color:white; margin:0; }

    google-cast-launcher {
      width: 32px;
      height: 32px;
      margin-left: 8px;
      --google-cast-launcher-color: white;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div id="video-container" style="width:100%; height:75vh;">
  <video id="video" autoplay></video>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {

    await shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) return;

    const video = document.getElementById('video');
    const container = document.getElementById('video-container');

    // ðŸ‘‰ Agregamos el botÃ³n Cast a la configuracion de Shaka UI
    const uiConfig = {
      controlPanelElements: [
        'play_pause',
        'time_and_duration',
        'mute',
        'volume',
        'spacer',
        'fullscreen',
        'cast'   // ðŸ‘ˆ AcÃ¡ lo integramos en la barra
      ],
      addSeekBar: true
    };

    // Registramos un elemento personalizado de Shaka para que "cast" funcione
    shaka.ui.Controls.registerElement('cast', new class {
      constructor(parent, controls) {
        this.parent = parent;
        this.button = document.createElement('google-cast-launcher');
        this.parent.appendChild(this.button);
      }
      release() {}
    });

    // Inicializamos UI + Player
    const ui = new shaka.ui.Overlay(
      new shaka.Player(video),
      container,
      video
    );

    ui.configure(uiConfig);
    const player = ui.getControls().getPlayer();

    // ClearKey para tu MPD
    player.configure({
      drm: {
        clearKeys: {
          "cc8c82ac2ec7e9799527c29db7354e81":
          "cc4aae173dd2ef17ae26be3f7ae87662"
        }
      }
    });

    // Cargamos el MPD
    try {
      await player.load("https://cdn.cvattv.com.ar/live/c6eds/Canal7/SA_Live_dash_enc/Canal7.mpd");
      console.log("Reproduciendoâ€¦");
    } catch (err) {
      console.error(err);
    }
  });
</script>

</body>
</html>
