<!DOCTYPE html>
<html>
<head>
    <title>Cast Sender Test</title>
    <script src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>
<body>

    <h2>Prueba Minimalista Sender</h2>
    
    <google-cast-launcher></google-cast-launcher>
    
    <br><br>
    <button onclick="loadMedia()">Cargar Video (DASH)</button>

    <script>
        // --- CONFIGURACIÓN ---
        // REEMPLAZA ESTO CON TU ID DE LA CONSOLA DE CAST
        const applicationID = 'TU_APP_ID_AQUI'; 
        
        // Video de prueba (Angel One - DASH)
        const streamUrl = 'https://storage.googleapis.com/shaka-demo-assets/angel-one/dash.mpd';
        const streamType = 'application/dash+xml';

        // 1. Inicialización
        window['__onGCastApiAvailable'] = function(isAvailable) {
            if (isAvailable) {
                cast.framework.CastContext.getInstance().setOptions({
                    receiverApplicationId: applicationID,
                    autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
                });
            }
        };

        // 2. Función para enviar el video
        function loadMedia() {
            const castSession = cast.framework.CastContext.getInstance().getCurrentSession();
            
            if (!castSession) {
                alert('Primero conéctate al Chromecast usando el icono.');
                return;
            }

            const mediaInfo = new chrome.cast.media.MediaInfo(streamUrl, streamType);
            // Metadata opcional para que se vea bonito en pantalla
            mediaInfo.metadata = new chrome.cast.media.GenericMediaMetadata();
            mediaInfo.metadata.title = 'Shaka Test Video';
            mediaInfo.metadata.subtitle = 'Minimalist Test';

            const request = new chrome.cast.media.LoadRequest(mediaInfo);

            castSession.loadMedia(request).then(
                function() { console.log('Carga exitosa'); },
                function(errorCode) { console.error('Error al cargar:', errorCode); }
            );
        }
    </script>
</body>
</html>