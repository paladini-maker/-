<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sender — Cast Web Sender (solo MPD)</title>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <script>
    const CONFIG = {
      APP_ID: 'AAA48312',
      MIME: 'application/dash+xml',
      DEFAULT_MPD: 'https://cdn.cvattv.com.ar/live/c6eds/Canal7/SA_Live_dash_enc/Canal7.mpd'
    };

    // Inicializar CastContext según la doc
    window.addEventListener('load', () => {
      const ctx = cast.framework.CastContext.getInstance();
      ctx.setOptions({ receiverApplicationId: CONFIG.APP_ID, autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED });
    });

    // Envía solo la URL del MPD. El receiver será responsable de aplicar ClearKeys.
    function castLoad(mpdUrl = CONFIG.DEFAULT_MPD) {
      const session = cast.framework.CastContext.getInstance().getCurrentSession();
      if (!session) return console.warn('No hay sesión Cast activa');
      if (typeof mpdUrl !== 'string' || !mpdUrl.startsWith('http')) return console.error('MPD inválido');

      const mediaInfo = new chrome.cast.media.MediaInfo(mpdUrl, CONFIG.MIME);
      const request = new chrome.cast.media.LoadRequest(mediaInfo);
      request.autoplay = true;
      request.currentTime = 0;

      // No enviar claves, metadatos sensibles ni EME desde el sender.
      session.loadMedia(request).catch(e => console.error('Sender load error:', e));
    }

    // Exponer para pruebas desde la consola
    window.castLoad = castLoad;
  </script>
</head>
<body></body>
</html>
