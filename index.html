<!DOCTYPE html>
<html>
<head>
    <title>Shaka Player con Cast Integration</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/controls.min.css">
    
    <style>
        body { 
            background-color: #222; 
            color: white; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 50px;
        }
        /* Contenedor del video: Shaka necesita un div wrapper */
        .video-container {
            width: 640px;
            margin: 0 auto;
        }
        video {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <h1>Shaka Player + Google Cast</h1>

    <div class="video-container" data-shaka-player-container>
        <video data-shaka-player id="video" poster="//shaka-player-demo.appspot.com/assets/poster.jpg"></video>
    </div>

    <script defer src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.ui.min.js"></script>

    <script>
        // El manifiesto DASH que vamos a reproducir (Video adaptativo)
        const manifestUri = 'https://storage.googleapis.com/shaka-demo-assets/angel-one/dash.mpd';
        
        // TU APP ID de Receiver (Usa 'CC1AD845' si no tienes uno propio, es el Default Media Receiver)
        const CAST_APP_ID = '86E6AFAF'; 

        async function init() {
            // Al finalizar la carga del DOM, iniciamos Shaka
            const video = document.getElementById('video');
            const videoContainer = document.querySelector('.video-container'); // UI Container
            
            // Inicializar la UI de Shaka (Player + Interfaz gráfica)
            const ui = new shaka.ui.Overlay(new shaka.Player(video), videoContainer, video);
            const controls = ui.getControls();
            const player = controls.getPlayer();

            // --- AQUÍ ESTÁ LA INTEGRACIÓN CON CAST ---
            
            // Configuramos la UI para incluir el botón de Cast y definir el App ID
            ui.configure({
                cast: {
                    receiverApplicationId: CAST_APP_ID,
                    androidReceiverCompatible: false
                },
                overflowMenuButtons: ['cast', 'quality', 'language', 'playback_rate'] // Añadimos 'cast' al menú si no cabe
            });

            // Configurar listeners de errores
            player.addEventListener('error', onErrorEvent);
            controls.addEventListener('caststatuschanged', onCastStatusChanged);

            // Cargar el video
            try {
                await player.load(manifestUri);
                console.log('El video ha sido cargado exitosamente en el player local.');
            } catch (e) {
                onError(e);
            }
        }

        function onCastStatusChanged(e) {
            // Shaka nos avisa cuando nos conectamos o desconectamos
            const newStatus = e['newStatus']; // bool: true (conectado) / false (desconectado)
            if (newStatus) {
                console.log("¡Conectado a Chromecast! Shaka está delegando la reproducción.");
            } else {
                console.log("Desconectado de Chromecast. Reproducción local.");
            }
        }

        function onErrorEvent(event) {
            onError(event.detail);
        }

        function onError(error) {
            console.error('Error código', error.code, 'objeto', error);
        }

        // Esperar a que el DOM esté listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
