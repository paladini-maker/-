<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sender — Cast Web Sender con UI</title>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <style>
    body{font-family:sans-serif;margin:20px;background:#111;color:#eee}
    button{margin:5px;padding:10px 20px;background:#2979ff;color:white;border:none;border-radius:4px;cursor:pointer}
    input{width:60%;padding:8px;margin-right:5px}
  </style>
</head>
<body>
  <h2>Web Sender — Carga MPD a Chromecast</h2>
  <input id="mpdInput" type="text" value="https://cdn.cvattv.com.ar/live/c6eds/Canal7/SA_Live_dash_enc/Canal7.mpd">
  <button id="loadBtn">Cargar MPD</button>

  <script>
    const CONFIG = { APP_ID: 'APP_ID', MIME: 'application/dash+xml' };

    window.addEventListener('load', () => {
      const ctx = cast.framework.CastContext.getInstance();
      ctx.setOptions({ receiverApplicationId: CONFIG.APP_ID, autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED });
    });

    document.getElementById('loadBtn').addEventListener('click', async () => {
      const mpdUrl = document.getElementById('mpdInput').value;
      const session = cast.framework.CastContext.getInstance().getCurrentSession();
      if (!session) return alert('No hay sesión Cast activa');

      // Cancelar media previa si existe
      const currentMedia = session.getMediaSession();
      if (currentMedia) {
        try { await currentMedia.stop(); } catch(e) { console.warn('Error al detener media previa', e); }
      }

      const mediaInfo = new chrome.cast.media.MediaInfo(mpdUrl, CONFIG.MIME);
      const request = new chrome.cast.media.LoadRequest(mediaInfo);
      request.autoplay = true;
      request.currentTime = 0;

      session.loadMedia(request).catch(e => console.error('Error load sender:', e));
    });
  </script>
</body>
</html>
